<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Player Douglas Almondes</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1db954">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<script src="https://cdn.jsdelivr.net/npm/jsmediatags@3.9.7/dist/jsmediatags.min.js"></script>

<style>
body{
  margin:0;
  background:#0b0b0b;
  color:#fff;
  font-family:system-ui, Arial;
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
}
.box{text-align:center}
#installBtn{
  position:fixed;
  right:15px;
  bottom:15px;
  padding:10px 16px;
  border:none;
  border-radius:999px;
  background:#1db954;
  color:#021;
  font-weight:bold;
  cursor:pointer;
  display:none;
}
</style>
</head>
<body>

<button id="installBtn">Instalar</button>

<div class="box">
  <h1>üéµ Douglas Music PRO</h1>
  <p>PWA pronta para uso.</p>
  <input id="fileInput" type="file" multiple accept="audio/*">
  <br><br>
  <button id="playBtn">‚ñ∂Ô∏è Play</button>
</div>

<audio id="audio"></audio>

<script>
// ================= SERVICE WORKER =================
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}

// ================= INSTALL PWA =================
let deferredPrompt;
const installBtn = document.getElementById('installBtn');

window.addEventListener('beforeinstallprompt', (e)=>{
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'block';
});

installBtn.addEventListener('click', async ()=>{
  if(!deferredPrompt) return;
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  deferredPrompt = null;
  installBtn.style.display = 'none';
});

// ================= PLAYER SIMPLES =================
const audio = document.getElementById('audio');
const fileInput = document.getElementById('fileInput');
const playBtn = document.getElementById('playBtn');

let files = [];
let index = 0;

fileInput.addEventListener('change', e=>{
  files = Array.from(e.target.files);
  index = 0;
  load();
});

function load(){
  if(!files.length) return;
  audio.src = URL.createObjectURL(files[index]);
}

playBtn.onclick = ()=>{
  if(audio.paused) audio.play();
  else audio.pause();
};
</script>

</body>
</html>
